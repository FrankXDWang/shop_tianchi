

天池比赛，商场中精确定位用户所在店铺初赛解决方案

作者：ethanw

邮箱：ethan_w@aliyun.com

## 赛题概述

赛题描述具体见[天池](https://tianchi.aliyun.com/competition/introduction.htm?spm=5176.100150.711.4.4fbcba610rOsSS&raceId=231620)。

## 解决方案

### 1.数据清洗

wifi信息在这道题里面十分重要。我们针对wifi进行了以下数据清洗:

- 首先,对商场的wifi出现次数进行了统计,过滤掉出现次数大于50%的wifi。我们认为这些wifi属于商场的公共wifi,或者是联通、移动等运营上的wifi。
- 其次,对于特定的店铺,过滤掉了出现次数在后20%的wifi(如果该店铺所有wifi只出现一次,则不过滤)。我们认为,这些wifi可能是个人移动热点。

### 2.构建候选集

我们的整体思路是使用二分类解决该问题。训练集给出了正样本，构建候选集的步骤相当于不知道正样本的情况下，针对训练集和候选集，采取一样的方法，找到最有可能的一些候选店铺。再对这些店铺加上标签进行训练模型。

#### 2.1店铺指纹构建

取出店铺的历史交易数据中的wifi信息。对交易记录的每条wifi信息，按照强度排序，排序后编号1~10作为该wifi在这条交易记录的wifi。然后，统计在该店铺中每个wifi出现的频次和rank的平均值，加权计算排序系数:

![![img](http://onkpm5zlx.bkt.clouddn.com/%E5%85%AC%E5%BC%8F.png)](http://onkpm5zlx.bkt.clouddn.com/%E5%85%AC%E5%BC%8F.png)

也就是将wifi出现频次除以该店铺wifi出现wifi的最高频次乘以10，再减去该wifi rank的平均值。使用这个score指标来重新对该店铺的所有wifi重新进行排序。取前10作为wifi指纹。

#### 2.2构造候选集

对于一个交易记录，将wifi信息按照强度进行排序后，计算其和该商场内所有店铺的wifi指纹的相似性，选取相似性最强的一些样本作为候选集。具体的计算方式有：

- match score：查找wifi是否在某店铺wifi指纹中。将wifi在店铺wifi指纹中出现的wifi对应的频数相加，除以该wifi指纹所有的频数和。
- LCS:计算交易信息wifi序列和店铺wifi指纹序列的lcs。

使用match score，我们发现在不泄露标签的情况下，构造10个样本可以覆盖训练集96.7%的正样本。

### 3.模型训练

我们主要使用lightgbm训练二分类模型。

训练的方式是：使用前两周数据作为参照集1（参照集用来作为历史记录的参考，构建店铺wifi指纹，抽取特征等等），对后两周进行特征抽取。再使用后两周时间作为参照集2，对测试集进行特征抽取。

特征方面主要包括以下特征:

1.时间特征

- 小时特征
- 是否工作日

2.店铺-用户距离特征

- 经纬度距离差值
- 绝对值
- uclidean距离
- manhattan距离
- haversine距离
- 斜率
- 方向角

3.用户-在该店铺消费用户平均经纬度距离特征（同上）

4.店铺热度特征

- 该店铺有多少人访问
- 多少次访问
- 访问该店铺次数/访问店铺所在商场次数

5.用户特征

- 用户来过该店铺多少次
- 用户来该店铺次数/消费总次数
- 用户来该店铺次数/来该商场次数
- 用户去过该店铺所在类别次数,比例
- 用户历史消费店铺消费水平和该店铺差值

6.wifi特征

- 上述match score
- LCS
- 用户wifi序列和wifi序列交集比例/逆序数
- 等等

